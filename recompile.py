import json, string

dirs = "./jsons"

vendor_j = "{}/vendor.json".format(dirs)
vendor_k = "Vendor,Id-regex".split(",")
vendor = [  ["K7AntiVirus",[0]] ,\
                    ["K7GW",[0]] ,\
                 ["FireEye",[100,101,102,103]] ,\
        ["MicroWorld-eScan",[100,101,102,103]] ,\
                   ["ALYac",[270,102,103]] ,\
             ["BitDefender",[270,102,103]] ,\
                ["Ad-Aware",[270,102,103]] ,\
                   ["Cyren",[110,111,112]] ,\
                 ["ViRobot",[120,121,122]] ,\
                ["F-Secure",[130,131,132,133,134,135,136]] ,\
               ["Microsoft",[140,141]] ,\
                 ["Arcabit",[270,102,103]] ,\
                ["AegisLab",[280,250]] ,\
                   ["Avast",[160,161,2]] ,\
                     ["AVG",[160,161,2]] ,\
               ["Kaspersky",[170,171,172,173]] ,\
               ["ZoneAlarm",[170,171,172,173]] ,\
               ["AhnLab-V3",[180]] ,\
                ["Fortinet",[190,191,192,193,1,3,4,6,9]] ,\
               ["Qihoo-360",[200,201,202,203,204,205,206]] ,\
                   ["Avira",[210,211,212,213,12]] ,\
                   ["GData",[220,221,222,223,224,225,226]] ,\
              ["TrendMicro",[230,231,232,233,234,235]] ,\
    ["TrendMicro-HouseCall",[230,231,232,233,234,235]] ,\
               ["Antiy-AVL",[241, 240]] ,\
                ['Emsisoft',[150,151,152,153,154,155,156]] ,\
                ['Jiangmin',[150,151,152,153,154,155,156,5,7]] ,\
                  ['Rising',[150,151,152,153,154,155,156]] ,\
                  ['Zillya',[250]] ,\
                 ['Alibaba',[140,141]] ,\
                 ['ESET-NOD32',[190,191,192,193,194,8]] ,\
             ['NANO-Antivirus',[170,171,172,173]] ,\
                ['Symantec',[100,101,102,103,2]] ,\
                   ['VBA32',[260,261]] ,\
                 ['Webroot',[220,221,222,223,224,225,226]] ,\
           ['CAT-QuickHeal',[100,101,102,103]] ,\
                  ['ClamAV',[220,221,222,223,224,225,226]] ,\
                   ['DrWeb',[150,151,152,153,154,155,156]] ,\
                  ['Ikarus',[290,291,10,11]] ,\
                   ['Panda',[300,301,302,303]] ,\
                 ['Tencent',[310]] ,\
                  ['Yandex',[320,321,322,323,324,325]] ,\
                   ['Baidu',[220,221,222,223,224,225,226]] ,\
                  ['F-Prot',[110,111,112,113,114]] ,\
            ['Malwarebytes',[330,331,332]] ,\
            ['TotalDefense',[340,341,342]] ,\
        ['SUPERAntiSpyware',[350,351,352,353,354,355,356]] ,\
                   ['Zoner',[360,361]] ]



regex_j = "{}/regex.json".format(dirs)
regex_k = "id,compose,example,form_regex,regex".split(",")
regex = [    [0,"MT ( VC )"             ,"Trojan ( 0054ee651 )"                  ,0 ,0] ,\
             [1,"INF.VC"                ,"Malicious_Behavior.SB"                 ,0 ,"(.*Behavior)\.(.*)"] ,\
             [2,"MT"                    ,"Trojan Horse"                          ,0 ,0] ,\
             [3,"INF.INF"               ,"PossibleThreat.PALLAS.H"               ,0 ,"(.*Threat)\.(.*)"] ,\
             [4,"INF"                   ,"PossibleThreat"                        ,0 ,"(.*Threat)"] ,\
             [5,"INF-MT/MF"             ,'I-Worm/Anap'                           ,0 ,0] ,\
             [6,"MT_MF.VC"              ,'Malware_fam.NB'                        ,0 ,0] ,\
             [7,"P/MF"                  ,"Win32/Fosforo"                         ,0 ,0] ,\
             [8,"INF"                   ,'multiple detections'                   ,0 ,"(multiple detections)"] ,\
             [9,"INF!MT"                ,'RKProc!tr'                             ,0 ,0] ,\
             [10,"INF INF"              ,'BehavesLike 1k w'                      ,0 ,"(BehavesLike) (.*)"] ,\
             [11,"INF"                  ,'BehavesLike'                           ,0 ,"(BehavesLike)" ] ,\
             [12,"INF"                  ,'E.F.V.S.F.C'                           ,0 ,"(E\.F\.V\.S\.F\.C)" ] ,\

             [100,"MT.MF.P.VC"          ,"Trojan.Ransomware.GenericKDS.32046564" ,0 ,0] ,\
             [101,"MT.P.VC!VC"          ,"Trojan.Win32.333444!BT"                ,0 ,0] ,\
             [102,"MT.P.VC"             ,"Trojan.GenericKDS.32046564"            ,0 ,0] ,\
             [103,"MT.MF"               ,"Trojan.P"                              ,0 ,0] ,\

             [110,"P/MT.MF-VC"          ,"W32/Trojan.VIVX-3268"                  ,0 ,0] ,\
             [111,"P/MT.VC"             ,"W32/Trojan2.OUQH"                      ,0 ,0] ,\
             [112,"P/MT!VC"             ,"W32/Malware!75f5"                      ,0 ,0] ,\
             [113,"P/MT-MT"             ,'W32/Parasitic-Fileinfector-base'       ,0 ,0] ,\
             [114,"P/MT"                ,'Unix/Vit'                              ,0 ,0] ,\

             [120,"MT.P.MT.VC"          ,"Trojan.Win32.Nemty.197088"             ,0 ,0] ,\
             [121,"MT.MF.VC[INF]"       ,"Dropper.GoBind.11264[UPX]"             ,0 ,0] ,\
             [122,"MT.MF.VC"            ,"Dropper.GoBind.11264"                  ,0 ,0] ,\

             [130,"MT.MT/MF.VC"         ,"Trojan.TR/Zudochka.ambvh"              ,0 ,0] ,\
             [131,"MT.P/MF.VC"          ,"Malware.LINUX/PsychoFor.2"             ,0 ,"(.*)\.(LINUX)\/(.*)\.(.*)"] ,\
             [132,"MT.P/MF"             ,"Malware.LINUX/PsychoFor"               ,0 ,"(.*)\.(LINUX)\/(.*)"] ,\
             [133,"MT-MT:P/MF.VC"       ,"Trojan-Dropper:W32/CozyDuke.C"         ,0 ,0] ,\
             [134,"MT:P/MF.VC"          ,'Riskware:W32/NetCat.C'                 ,0 ,0] ,\
             [135,"MT:P/MF"             ,'Riskware:W32/NetCat'                   ,0 ,0] ,\
             [136,"MT.P/MF"             ,'Malware.W32/Vampiro'                   ,0 ,0] ,\

             [140,"MT:P/MF.VC"          ,"Trojan:Win32/Occamy.C"                 ,0 ,0] ,\
             [141,"MT:P/MF"             ,'HackTool:MSIL/StormRAT'                ,0 ,0] ,\

             [150,"MT.P.MF.VC (INF)"    ,'Generic.Malware.SDb.0ED3DDF9 (B)'      ,0 ,0] ,\
             [151,"MT.MF!VC (INF)"      ,'Trojan.Zpevdo!8.F912 (CLOUD)'          ,0 ,0] ,\
             [152,"MT.P.VC (INF)"       ,'Trojan.GenericKD.34273962 (B)'         ,0 ,0] ,\
             [153,"MT.MF.VC"            ,'Trojan.DownLoader11.18170'             ,0 ,"(.*)\.(.*)\.(\d{1,10})"] ,\
             [154,"MT.P.VC"             ,"Trojan.Generic.D1E8FDE4"               ,0 ,0] ,\
             [155,"MT.MF (INF)"         ,"Trojan-Dropper.Inpect (A)"             ,0 ,0] ,\
             [156,"MT.MF"               ,"Trojan.Inpect"                         ,0 ,0] ,\

             [160,"P:MF [MT]"           ,"Win32:DangerousSig [Trj]"              ,0 ,0] ,\
             [161,"P:MT"                ,"Win32:Trojan-gen"                      ,0 ,0] ,\

             [170,"INF:MT.P.MF.VC"     ,"HEUR:Trojan-Spy.MSIL.Noon.gen"          ,0 ,0] ,\
             [171,"INF:MT.P.P"         ,"HEUR:Trojan.Win32.Generic"              ,0 ,0] ,\
             [172,"MT.P.MF.VC"         ,"Trojan-Spy.MSIL.Noon.gen"               ,0 ,0] ,\
             [173,"MT.P.MF"            ,"Trojan-Spy.MSIL.Noon"                   ,0 ,0] ,\
             
             [180,"MT/P.MF.VC"         ,"Trojan/Win32.Kryptik.C3289665"          ,0 ,0] ,\

             [190,"INF P/MF.MF.VC"     ,'a variant of MSIL/TrojanDropper.Agent.ASX' ,0 ,0] ,\
             [191,"P/MF.VC!VC"         ,"MSIL/Kryptik.RTU!tr"                    ,0 ,0] ,\
             [192,"P/MF.VC"            ,"MSIL/ChadowTek.A"                       ,0 ,0] ,\
             [193,"MT/MF"              ,"Riskware/BadJoke"                       ,0 ,0] ,\
             [194,"MT.VC"              ,"Generik.INVAUYQ"                        ,0 ,0] ,\

             [200,"P/MT.VC.MF.VC"      ,"HEUR/QVM03.0.Malware.Gen"               ,0 ,"(.*)\/(.*)\.(\d{1,2})\.(.*)\.(.*)"] ,\
             [201,"P/MT.MF.VC"         ,"Win32/Trojan.Spy.beb"                   ,0 ,0] ,\
             [202,"P/MT.VC"            ,"Win32/Trojan.f3c"                       ,0 ,"(.*)\/(.*)\.([a-f0-9]+)"] ,\
             [203,"MT.P.MF.VC"         ,"Virus.Win32.Virut.AL"                   ,0 ,0] ,\
             [204,"P.MT.VC"            ,'Win32.PhpStudyGhost.A'                  ,0 ,"(.*)\.(.*)\.(\w)"] ,\
             [205,"MT.MF.MT"           ,'Malware.Radar01.Gen'                    ,0 ,"(.*)\.(.*)\.(Generic|Gen)"] ,\
             [206,"MT.MT"              ,'Trojan.Generic'                         ,0 ,"(.*)\.(Generic|Gen)"] ,\

             [210,"MT/MF.VC"           ,"TR/Zudochka.ambvh"                      ,0 ,0] ,\
             [211,"P/MF.VC"            ,'LINUX/PsychoFo.c'                       ,0 ,"(.*)\/(.*)\.(.*)"] ,\
             [212,"P/MF"               ,'LINUX/PsychoFo'                         ,0 ,"(.*)\/(.*)"] ,\
             [213,"INF.INF"            ,'nc.exe'                                 ,0 ,"(.*)\.(exe|dll)"] ,\

             [220,"P.MT.MF-VC"         ,'Win.Trojan.Agent-1192287'               ,0 ,0] ,\
             [221,"P.MT.MF.VC"         ,"Win32.Trojan-Ransom.Nefilim.A"          ,0 ,0] ,\
             [222,"MT.P.VC"            ,"Trojan.GenericKD.34273962"              ,0 ,"(.*)\.(.*)\.(\d{1,10})"] ,\
             [223,"P.MT.MF"            ,"MSIL.Packed.Skaldring"                  ,0 ,0] ,\
             [224,"P.MT"               ,"W32.Miner"                              ,0 ,"(W32)\.(.*)"] ,\
             [225,"MT.MT"              ,'Bitcoinminer.Gen'                       ,0 ,0] ,\
             [226,"MF:P/MF"            ,'TrojanSpy:Win32/Webmoner'               ,0 ,0] ,\

             [230,"MT.P.MF.VC.INF"     ,"Ransom.Win32.NEFILIM.A.B"               ,0 ,0] ,\
             [231,"MT.P.MF.VC"         ,"Ransom.Win32.NEFILIM.A"                 ,0 ,0] ,\
             [232,"MT.P.P!VC"          ,"Trojan.Win32.Generic!BT"                ,0 ,0] ,\
             [233,"MT.P.MF"            ,"Ransom.Win32.NEFILIM"                   ,0 ,0] ,\
             [234,"MT_MF.VC"           ,"TROJ_GEN.R002C0WFC19"                   ,0 ,0] ,\
             [235,"MT_MF"              ,'PAK_Xed-21'                             ,0 ,0] ,\

             [240,"MT/P.MF"            ,"Trojan/Win32.Swrort"                    ,0 ,0] ,\
             [241,"MF[MT]/P.MF"        ,"GrayWare[AdWare]/Win32.Agent"           ,0 ,0] ,\

             [250,"MT.MF.P.VC"         ,"Trojan.Generic.Win32.568678"            ,0 ,0] ,\

             [260,"MF.MT.P"            ,"TScope.Trojan.MSIL"                     ,0 ,0] ,\
             [261,"MT.MF"              ,"TrojanDownloader.Zload"                 ,0 ,0] ,\

             [270,"P.MT.MF.VC"         ,"Generic.Malware.SDb.0ED3DDF9"           ,0 ,0] ,\


             [280,"MT.P.MF.VC!VC"      ,"Trojan.Win32.Ursu.4!c"                  ,0 ,0] ,\

             [290,"MT.INF"             ,"Trojan.Crypter"                         ,0 ,0] ,\
             [291,"MT-INF"             ,"Trojan-Downloader"                      ,0 ,0] ,\

             [300,"MT/MF.VC"           ,"Trj/Chgt.B"                             ,0 ,0] ,\
             [301,"INF INF"            ,"Generic Malware"                        ,0 ,"(.*) (Malware|Packer|Suspicious|Program|Horse)"] ,\
             [302,"MT.VC"              ,"Trojan Horse.LC"                        ,0 ,0] ,\
             [303,"P/INF"             ,'PUP/InstallCore'                         ,0 ,0] ,\

             [310,"P.MT.P.MF"          ,"Win32.Trojan.Generic.Swbm"              ,0 ,0] ,\

             [320,"MT.P.MF!VC"         ,"Trojan.DR.Agent!NylViRoa1m0"            ,0 ,0] ,\
             [321,"MT.MF!VC"           ,"Trojan.Bumat!I37zd55Blpg"               ,0 ,0] ,\
             [322,"P.MF.MT.VC"         ,"Win32.Virut.Gen.4"                      ,0 ,0] ,\
             [323,"INF.INF-INF.INF"    ,'Exploit.MS04-022.A'                     ,0 ,0] ,\
             [324,"MT.MF.VC"           ,'Trojan.AvsIgent.bS1qRU'                 ,0 ,0] ,\
             [325,"MT/INF"             ,'Packed/NSPack'                          ,0 ,"(Packed)\/(.*)"] ,\

             [330,"MT.MF.P.VC"         ,"Trojan.Emotet.W32.sk"                   ,0 ,0] ,\
             [331,"MT.MF.VC"           ,"Trojan.Emotet.sk"                       ,0 ,0] ,\
             [332,"MT.MF"              ,"Trojan.Emotet"                          ,0 ,0] ,\

             [340,"P/MF.VC"            ,"Win32/Virut.8704"                       ,0 ,0] ,\
             [341,"P/MF_VC"            ,'Win32/FakeFLDR_i'                       ,0 ,0] ,\
             [342,"P/MF"               ,'Win32/He4Hook'                          ,0 ,0] ,\

             [350,"MT.MT/VC-MF"        ,"Hack.Tool/Gen-BitCoinMiner"             ,0 ,0] ,\
             [351,"P.MF/MT"            ,'PUP.NetCat/Variant'                     ,0 ,0] ,\
             [352,"MT.MT-MF.VC"        ,'Trojan.Backdoor-PoisonIvy.2'            ,0 ,0] ,\
             [353,"MT.MT-MF"           ,'Trojan.Backdoor-PoisonIvy'              ,0 ,0] ,\
             [354,"MT.MF INF"          ,'Worm.Blaster Variant'                   ,0 ,"(.*)\.(.*) (Variant)"] ,\
             [355,"MT.MF"              ,'Rootkit.RESSdt'                         ,0 ,0] ,\
             [356,"MT/VC-MF"           ,'HackTool/Gen-RemoteAdmin'               ,0 ,0] ,\

             [360,"MT.P.MF.VC"         ,'Trojan.Win32.exg.38913'                 ,0 ,0] ,\
             [361,"MT.P.VC"            ,'Trojan.Win32.38913'                     ,0 ,0] ]




def vendor_recompile():
  output = []
  with open(vendor_j, "w") as fp:
    for elem in vendor :
      output.append( { vendor_k[idx]:x for idx,x in enumerate(elem) } )
    json.dump(output, fp)

def to_regex_form(str1):
  keys = ["MT", "P", "MF", "VC", "INF"]
  for k in (set(string.punctuation) - set('\\')) :
    str1 = str1.replace(k, "\{}".format(k))
  for k in keys :
    str1 = str1.replace(k, "(.*)")
  return str1

def regex_recompile():
  output = []
  with open(regex_j, "w") as fp :
    for elem in regex :

      elem[-2] = to_regex_form(elem[1])
      if elem[-1] == 0 :
        elem[-1] = to_regex_form(elem[1])

      elem[-2] = "^{}$".format(elem[-2])
      elem[-1] = "^{}$".format(elem[-1])

      output.append( { regex_k[idx]:x for idx,x in enumerate(elem) } )
    json.dump(output, fp)

vendor_recompile()
regex_recompile()
